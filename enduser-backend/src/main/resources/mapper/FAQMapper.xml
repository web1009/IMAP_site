<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.project.app.faq.mapper.FAQMapper">

    <!-- =========================
         USER FAQ 목록 조회
         - community_post 테이블 조회
         - post_type = 'FAQ'
         - is_visible = 1 (노출된 것만)
         - display_end 체크 (종료되지 않은 것만, 또는 display_end가 NULL인 것)
         ========================= -->
    <select id="selectUserFaqList"
            resultType="com.project.app.faq.dto.FAQDto">

        SELECT
            cp.post_id      AS postId,
            cp.post_type    AS postType,
            cp.category     AS category,
            cp.title        AS title,
            cp.content      AS content,
            cp.is_visible   AS isVisible,
            cp.created_at   AS createdAt
        FROM community_post cp
        WHERE cp.post_type = 'FAQ'
          AND cp.is_visible = 1
          AND (
                cp.display_end IS NULL
                OR cp.display_end >= NOW()
          )
        ORDER BY cp.created_at DESC

    </select>

    <!-- =========================
         USER FAQ 상세 조회
         - 펼쳐진 상태에서 내용 표시용
         - is_visible = 1 (노출된 것만)
         - display_end 체크 (종료되지 않은 것만)
         ========================= -->
    <select id="selectUserFaqDetail"
            resultType="com.project.app.faq.dto.FAQDto">

        SELECT
            cp.post_id      AS postId,
            cp.post_type    AS postType,
            cp.category     AS category,
            cp.title        AS title,
            cp.content      AS content,
            cp.is_visible   AS isVisible,
            cp.created_at   AS createdAt
        FROM community_post cp
        WHERE cp.post_id = #{postId}
          AND cp.post_type = 'FAQ'
          AND cp.is_visible = 1
          AND (
                cp.display_end IS NULL
                OR cp.display_end >= NOW()
          )

    </select>

</mapper>
